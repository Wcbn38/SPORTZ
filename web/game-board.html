<!DOCTYPE html>
<script>
    function mapWebPrms(prms) {
        if (prmArray != "") {
            var prmArray = prms.split("&")
            return prmArray.reduce((m, e) => {
                var splt = e.split("=")
                if (splt.length == 2) {
                    m[splt[0]] = splt[1]
                }
                return m
            }, {})
        } else {
            return {}
        }
    }

    function loadServers() {
        document.getElementById("loader").style.display = 'block'
        cookieMap = mapWebPrms(document.cookie)

        args = document.location.href.split('?')[1]
        argsMap = mapWebPrms(args)

        fetch(`${document.location.origin}/game-properties?gameid=${argsMap["gameid"]}`, {
            method: "POST",
            body: "",
            headers: {
                "Content-type": "application/x-www-form-urlencoded; charset=UTF-8",
                "Content-Length": 0,
                "Cookies": cookieMap["pwd"]
            }
        })
        .then((response) => response.json())
        .then((json) => {
            document.getElementById("loader").style.display = 'none'

            playerSection = document.getElementById("players")
            playerSection.innerHTML = ''

            let header = playerSection.appendChild(document.createElement("tr"))
            header.appendChild(document.createElement("th")).innerHTML = "Name"
            header.appendChild(document.createElement("th")).innerHTML = "Vote"
            header.appendChild(document.createElement("th")).innerHTML = "Voted"

            json.forEach(el => {
                const playerEl = document.createElement("tr")

                nel = document.createElement("th")
                playerEl.appendChild(document.createElement("th")).innerHTML = el["username"]
                playerEl.appendChild(document.createElement("td")).innerHTML = el["vote"]
                playerEl.appendChild(document.createElement("td")).innerHTML = json.map(e => e['vote'] == el['id']).filter(e => e).length

                if (el["dead"]) {
                    playerEl.classList.add("greyed")
                }

                playerSection.appendChild(playerEl)
            });
        });
    }
</script>
<html>
    <head>
        <title>
            Game board
        </title>
        <link rel="stylesheet" type="text/css" href="loader.css">
        <link rel="stylesheet" type="text/css" href="admin-general.css">
        <div style="padding: 20px; width: 500px; display: grid; grid-template-columns: auto auto auto auto auto;">
            <button style="width: 120px; margin: 15px;">Start game</button>
            <button style="width: 120px; margin: 15px; background-color: green;">Start vote</button>
            <button style="width: 120px; margin: 15px; background-color: red;">End vote</button>
            <button style="width: 120px; margin: 15px;" onclick="loadServers()">Refresh</button>
            <div style="display: inline-block; margin-left: 8px; margin-top: 10px;" class="loader" id="loader"></div>
        </div>
    </head>
    <body onload="loadServers()">
        <div>
            <table id="players">
            </table>
        </div>
    </body>
</html>